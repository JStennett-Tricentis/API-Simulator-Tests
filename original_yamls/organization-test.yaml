schema: SimV1
name: organizationTest

connections:
  - name: organizationApi
    endpoint: http://localhost:28888
    listen: false

services:
  - name: testTenantsService
    description: Test for the Tosca Cloud Tenants API
    steps:
      - direction: Out
        name: sendTenantsRequest
        to: organizationApi
        buffer:
          - name: testToken
            value: "Bearer TOKEN"
        insert:
          - type: Path
            value: /internalApi/v1/tenants
          - type: Method
            value: GET
          - type: Header
            key: Authorization
            value: "{B[testToken]}"
          - type: Header
            key: Accept
            value: "*/*"
      
      - direction: In
        name: verifyTenantsResponse
        from: organizationApi
        verify:
          - jsonPath: $[0].name
            value: fusionx
          - jsonPath: $[0].organizationId
            value: b76f8d83-bf0d-49d5-8800-e69b5ab21768
          - jsonPath: $[0].internal
            value: true

  - name: testSpacesService
    description: Test for the Tosca Cloud Spaces API
    steps:
      - direction: Out
        name: sendSpacesRequest
        to: organizationApi
        buffer:
          - name: testToken
            value: "Bearer TOKEN"
        insert:
          - type: Path
            value: /internalApi/v1/tenants/fusionx/spaces
          - type: Method
            value: GET
          - type: Header
            key: Authorization
            value: "{B[testToken]}"
          - type: Header
            key: Accept
            value: "*/*"
      
      - direction: In
        name: verifySpacesResponse
        from: organizationApi
        verify:
          - jsonPath: $[0].id
            value: default
          - jsonPath: $[0].isBuiltIn
            value: true
          - jsonPath: $[0].name
            value: Default