schema: SimV1
name: toscaCloudPlaylistRecentRunsTest

connections:
  - name: playlistRecentRunsApi
    endpoint: http://localhost:18004
    listen: false

services:
  - name: testPlaylistRecentRunsBasic
    description: Basic test for the Tosca Cloud Playlist Recent Runs API
    steps:
      - direction: Out
        name: sendPlaylistRecentRunsRequest
        to: playlistRecentRunsApi
        buffer:
          - name: requestId
            value: "3945c58b8f31440e8191831dd5a24675"
          - name: parentId
            value: "046466fe614440dc"
        insert:
          - type: Path
            value: /_playlists/api/v2/playlistRuns/recentRuns
          - type: Header
            key: Authorization
            value: "Bearer TOKEN"
          - type: Header
            key: Accept
            value: "*/*"
          - type: Header
            key: request-id
            value: "|{B[requestId]}.{B[parentId]}"
          - type: Header
            key: traceparent
            value: "00-{B[requestId]}-{B[parentId]}-01"
          - type: Payload
            value: |
              {"limit":1,"playlistIds":["5aa77b0b-ca14-41eb-a20b-60b22473c405","6426cfa3-07ef-4521-9111-f574d999273a","b2b920b4-aa05-4d18-b080-96625ee1d2bd"]}

      - direction: In
        name: verifyPlaylistRecentRunsResponse
        from: playlistRecentRunsApi
        verify:
          - jsonPath: $[0].id
            value: edc46425-54f6-4497-a0e1-65d090c27afd
          - jsonPath: $[0].playlistName
            value: WIP
          - jsonPath: $[0].state
            value: failed
          - jsonPath: $[1].id
            value: f20338b6-a16f-461f-85d2-ea3def100f6a
          - jsonPath: $[2].playlistName
            value: Dashboard - "Recently edited" Tests
